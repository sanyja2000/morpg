<html>


<body>
<canvas id="myCanvas"></canvas>



<script>

var answer;
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
canvas.width = 1000;
canvas.height = 700;

function update(){
    ctx.fillStyle = "grey";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    for(var i=0;i<answer.you_see.length;i++){
        if(answer.you_see[i].ItemId==1){
            ctx.fillStyle = "black";
            ctx.fillRect(answer.you_see[i]["X"],answer.you_see[i]["Y"],1,1);
        }
        else if(answer.your_units.indexOf(answer.you_see[i].ItemId)>-1){
            ctx.fillStyle = "blue";
            ctx.fillRect(answer.you_see[i]["X"]-1,answer.you_see[i]["Y"]-1,3,3);
            ctx.strokeStyle = "lime";
            ctx.beginPath();
            ctx.arc(answer.you_see[i]["X"],answer.you_see[i]["Y"],100,0,Math.PI*2);
            ctx.closePath();
            ctx.stroke();
        }
        else if(answer.you_see[i].ItemId == 2){
            ctx.fillStyle = "yellow";
            ctx.fillRect(answer.you_see[i]["X"]-1,answer.you_see[i]["Y"]-1,3,3);
        } else if(answer.you_see[i].ItemId == 3){
            ctx.fillStyle = "green";
            ctx.fillRect(answer.you_see[i]["X"]-1,answer.you_see[i]["Y"]-1,3,3);
        }else{
            ctx.fillStyle = "red";
            ctx.fillRect(answer.you_see[i]["X"]-1,answer.you_see[i]["Y"]-1,3,3);
        }
        
    }
}

function tryUpdate(){
    var x = new XMLHttpRequest();
    //x.overrideMimeType('application/json');
    x.responseType = 'json';
    x.open("GET", "http://localhost/proba.json", true);
    //x.open("GET", "http://"+window.location.hostname+":80/tiled/underworld.tmx", true);
    x.onreadystatechange = function () {
        if (x.readyState == 4 && x.status == 200)
        {  
            console.log(x);
            answer = x.response;
            update();
        }
    }
    x.send(null);
}

var loop = setInterval(tryUpdate,1000);

</script>
</body>


</html>